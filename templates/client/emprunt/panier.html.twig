{% extends 'client/base.html.twig' %}
{% block body %}
<div class="container my-5">
    <h1 class="mb-4 text-primary">Demande d'emprunt</h1>

    {% for item in items %}
        <div class="card mb-3 shadow-sm">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="card-title">{{ item.livre.titre }}</h5>
                    <p class="mb-1"><i class="bi bi-clock"></i> Durée : <strong>{{ item.livre.dureeMaxEmprunt }} jours</strong></p>
                </div>
                <div class="text-end">
                    <p class="mb-1"><i class="bi bi-currency-dollar"></i> Frais : <strong>{{ item.frais }} DT</strong></p>
                    <p class="mb-1"><i class="bi bi-shield"></i> Caution : <strong>{{ item.caution }} DT</strong></p>
                    <h5 class="text-success mb-0"><i class="bi bi-check-circle"></i> {{ item.totalLigne }} DT</h5>
                </div>
            </div>
        </div>
    {% else %}
        <div class="alert alert-info">
            Votre panier est vide pour le moment.
        </div>
    {% endfor %}

    <div class="alert alert-warning mt-4 d-flex align-items-center">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <div>
            <strong>Garantie obligatoire :</strong> Pour valider votre emprunt, nous devons vérifier votre identité.<br>
            Après envoi de votre C.I.N., notre équipe validera votre demande sous 24h et vous enverra le lien de paiement.
        </div>
    </div>

    <form method="post" action="{{ path('client_emprunt_upload_cin') }}" enctype="multipart/form-data" class="mt-4">
        <div class="row g-3">
            <div class="col-md-6 text-center">
                <label for="cin_recto" class="form-label">Recto C.I.N. <span class="text-danger">*</span></label>
                <input type="file" id="cin_recto" name="cin_recto" accept="image/*" required class="form-control mb-2">
                <img id="preview_recto" src="#" alt="Aperçu recto" class="img-fluid rounded shadow-sm" style="max-height: 200px; display:none;">
                <small class="form-text text-muted">Formats acceptés : jpg, png, jpeg. Max 2MB.</small>
            </div>
            <div class="col-md-6 text-center">
                <label for="cin_verso" class="form-label">Verso C.I.N. <span class="text-danger">*</span></label>
                <input type="file" id="cin_verso" name="cin_verso" accept="image/*" required class="form-control mb-2">
                <img id="preview_verso" src="#" alt="Aperçu verso" class="img-fluid rounded shadow-sm" style="max-height: 200px; display:none;">
                <small class="form-text text-muted">Formats acceptés : jpg, png, jpeg. Max 2MB.</small>
            </div>
        </div>
        <button type="submit" class="btn btn-success btn-lg mt-3 w-100">
            <i class="bi bi-upload me-2"></i> Envoyer ma C.I.N. (demande en attente de validation)
        </button>
    </form>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

{# JS pour afficher l'aperçu des images #}
<script>
    function previewImage(input, previewId) {
        const preview = document.getElementById(previewId);
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        } else {
            preview.src = '#';
            preview.style.display = 'none';
        }
    }

    document.getElementById('cin_recto').addEventListener('change', function() {
        previewImage(this, 'preview_recto');
    });

    document.getElementById('cin_verso').addEventListener('change', function() {
        previewImage(this, 'preview_verso');
    });
</script>
{% endblock %}
