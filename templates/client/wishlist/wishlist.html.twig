{# templates/client/wishlist/index.html.twig #}
{% extends 'client/base.html.twig' %}
{% block title %}Ma Wishlist{% endblock %}

{% block body %}
{% include 'partials/header.html.twig' with { categorie: categorie } %}

<!-- Breadcrumb -->
<div class="breadcumb-wrapper" data-bg-src="{{ asset('client/img/bg/bg-site.png') }}">
    <div class="container z-index-common">
        <div class="breadcumb-content">
            <h1 class="breadcumb-title">Ma Wishlist</h1>
            <div class="breadcumb-menu-wrap">
                <div class="breadcumb-menu">
                    <span><a href="{{ path('app_home') }}">Accueil</a></span>
                    <span>Wishlist</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Wishlist Area -->
<div class="wishlist-area space">
    <div class="container">
        <div class="tinv-wishlist woocommerce tinv-wishlist-clear">
            <div class="tinv-header">
                <h2 class="mb-30">Ma Wishlist</h2>
            </div>

            {% for message in app.flashes('success') %}
                <div class="alert alert-success alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}

            {% if wishlist|length == 0 %}
                <div class="text-center py-5">
                    <h4>Votre wishlist est vide</h4>
                    <a href="{{ path('client_livre_index') }}" class="vs-btn">Continuer mes achats</a>
                </div>
            {% else %}
                <form action="#" method="post" autocomplete="off">
                    <table class="tinvwl-table-manage-list">
                        <thead>
                            <tr>
                                <th class="product-cb">
                                    <input type="checkbox" class="global-cb" title="Tout sélectionner" />
                                </th>
                                <th class="product-remove"></th>
                                <th class="product-thumbnail">Image</th>
                                <th class="product-name">
                                    <span class="tinvwl-full">Nom du livre</span>
                                    <span class="tinvwl-mobile">Livre</span>
                                </th>
                                <th class="product-price">Prix unitaire</th>
                                <th class="product-date">Ajouté le</th>
                                <th class="product-stock">Stock</th>
                                <th class="product-action">&nbsp;</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in wishlist %}
                                <tr class="wishlist_item">
                                    <td class="product-cb">
                                        <input type="checkbox" name="wishlist_pr[]" value="{{ item.id }}" />
                                    </td>
                                    <td class="product-remove">
                                        <a href="{{ path('client_wishlist_supprimer', {'id': item.id}) }}"
                                           onclick="return confirm('Supprimer ce livre de la wishlist ?')">
                                            <i class="fal fa-times"></i>
                                        </a>
                                    </td>
                                    <td class="product-thumbnail">
                                        <a href="{{ path('client_livre_show', {'id': item.livre.id}) }}">
                                            <img src="{{ item.livre.image ? asset('uploads/livres/' ~ item.livre.image) : asset('client/img/product/placeholder.jpg') }}"
                                                 class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail"
                                                 alt="{{ item.livre.titre }}"
                                                 width="100" height="130">
                                        </a>
                                    </td>
                                    <td class="product-name">
                                        <a href="{{ path('client_livre_show', {'id': item.livre.id}) }}">
                                            {{ item.livre.titre }}
                                        </a>
                                        <small class="text-muted d-block">
                                            par {{ item.livre.auteurs|map(a => a.prenom ~ ' ' ~ a.nom)|join(', ') }}
                                        </small>
                                    </td>
                                    <td class="product-price">
                                        <span class="woocommerce-Price-amount amount">
                                            <bdi>{{ item.livre.pu|number_format(2) }} <small>DT</small></bdi>
                                        </span>
                                    </td>
                                    <td class="product-date">
                                        <time datetime="{{ item.addedAt|date('Y-m-d') }}">
                                            {{ item.addedAt|format_datetime(locale='fr', pattern="d MMMM yyyy") }}
                                        </time>
                                    </td>
                                    <td class="product-stock">
                                        {% if item.livre.quantiteEnStock > 0 %}
                                            <p class="stock in-stock">
                                                <i class="fas fa-check"></i>
                                                <span class="tinvwl-txt">En stock</span>
                                            </p>
                                        {% else %}
                                            <p class="stock out-of-stock">
                                                <i class="fas fa-times"></i>
                                                <span class="tinvwl-txt">Rupture</span>
                                            </p>
                                        {% endif %}
                                    </td>
                                    <td class="product-action">
                                        {% if item.livre.quantiteEnStock > 0 %}
                                            <a href="{{ path('client_panier_ajouter', {'id': item.livre.id}) }}"
                                               class="button vs-btn alt">
                                                <i class="fal fa-shopping-cart"></i>
                                                <span class="tinvwl-txt"> Ajouter au panier</span>
                                            </a>
                                        {% else %}
                                            <button class="button vs-btn alt" disabled>
                                                <i class="fal fa-shopping-cart"></i>
                                                <span class="tinvwl-txt"> Indisponible</span>
                                            </button>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </form>

                <!-- Partage sur les réseaux -->
                <div class="social-buttons mt-4">
                    <span>Partager sur :</span>
                    <ul>
                        <li><a href="#" class="social social-facebook"><i class="fab fa-facebook-f"></i></a></li>
                        <li><a href="#" class="social social-twitter"><i class="fa-brands fa-x-twitter"></i></a></li>
                        <li><a href="#" class="social social-pinterest"><i class="fab fa-pinterest-p"></i></a></li>
                        <li><a href="#" class="social social-whatsapp"><i class="fab fa-whatsapp"></i></a></li>
                        <li><a href="#" class="social social-clipboard" onclick="copyWishlistLink(); return false;">
                            <i class="far fa-clipboard"></i>
                        </a></li>
                        <li><a href="#" class="social social-email"><i class="far fa-envelope"></i></a></li>
                    </ul>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{{ include('partials/footer.html.twig') }}

<script>
// Copier le lien de la wishlist
function copyWishlistLink() {
    navigator.clipboard.writeText(window.location.href);
    alert('Lien de la wishlist copié dans le presse-papier !');
}
</script>
{% endblock %}